import os

path_to_perf_scripts_benign = "./perf_scripts_benign/"
path_to_perf_scripts_malware = "./perf_scripts_malware/"
path_to_benign_log_file = "./log_file_benign/"
path_to_malware_log_file = "./log_file_malware/"
indicator_list = ["ls", "ps", "netstat", "who", "pwd"]
path_to_malware_file = "../Malware_Program/"
path_to_benign_file = "../Benign_Program/"

execute_type_1 = ["arithoh", "context1", "dhry2", "dhry2reg", "double", "float", "hanoi", "int", "long", "pipe", "register", "spawn", "syscall"]
execute_type_2 = ["looper"]

def generate_benign():
    list_of_benign = os.listdir(path_to_benign_file)
    if not os.path.exists(path_to_perf_scripts_benign):
        os.makedirs(path_to_perf_scripts_benign)
    num_observations = 50
    num_indicators = len(indicator_list)
    files_run = []
    for item in list_of_benign:
    	if item in execute_type_1:
    		execute = path_to_benign_file + item + " 1"
    	elif item in execute_type_2:
    		execute = path_to_benign_file + item + " 1 gcc ../test.c"
    	else:
    		execute = path_to_benign_file + item
        log_file = item + ".txt"
        with open(path_to_perf_scripts_benign + item + ".sh", "w") as f:
            files_run.append(path_to_perf_scripts_benign + item + ".sh")
            for i in xrange(num_indicators):
                for j in xrange(num_observations):
                    f.write("3>>" + path_to_benign_log_file+log_file + " perf stat --log-fd 3 --append -e cycles,instructions,cache-references,cache-misses,branches,branch-misses " + indicator_list[i] + " & " + execute + "\nsleep 1s\necho -en \"\\n\"\n")
    with open("run_all_benign.sh", "w") as f:
        for file in files_run:
            f.write(file + "\n")
    os.system("chmod +x -R ../Offline")
    os.system("chmod +x -R " + path_to_benign_file)

def generate_malware():
    list_of_malware = os.listdir(path_to_malware_file)
    if not os.path.exists(path_to_perf_scripts_malware):
        os.makedirs(path_to_perf_scripts_malware)
    num_observations = 50
    num_indicators = len(indicator_list)
    files_run = []
    for item in list_of_malware:
        log_file = item + ".txt"
        with open(path_to_perf_scripts_malware + item + ".sh", "w") as f:
            files_run.append(path_to_perf_scripts_malware + item + ".sh")
            for i in xrange(num_indicators):
                for j in xrange(num_observations):
                    f.write("3>>" + path_to_malware_log_file+log_file + " perf stat --log-fd 3 --append -e cycles,instructions,cache-references,cache-misses,branches,branch-misses " + indicator_list[i] + " & " + path_to_malware_file + item + "\nsleep 1s\necho -en \"\\n\"\n")
    with open("run_all_malware.sh", "w") as f:
        for file in files_run:
            f.write(file + "\n")
    os.system("chmod +x -R ../Offline")
    os.system("chmod +x -R " + path_to_malware_file)
